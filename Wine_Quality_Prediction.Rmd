---
title: "Wine Quality Prediction"
author: "Kyle Krawl"
date: "4/6/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
env_dir = paste(getwd(), "./wine-quality", sep = "")
knitr::opts_knit$set(root.dir = env_dir)
```

### Environment Setup and Data Import

```{r}
## Load libraries used in analysis:

# Data manipulation:
library(dplyr)

# Visualizations:
library(ggplot2)
library(grid)
library(gridExtra)
library(ggpubr)
library(corrplot)

# Principal component analysis:
library(FactoMineR)
library(factoextra)
```

```{r}
## Load datasets:

# Red wines:
data_red <- read.csv("./Data/winequality-red.csv", header=TRUE, sep=";")

# White wines:
data_white <- read.csv("./Data/winequality-white.csv", header=TRUE, sep=";")

## Convert target variable to factor:

data_red$quality <- as.factor(data_red$quality)
data_white$quality <- as.factor(data_white$quality)

# Subset dataframe containing only independent variables:
data_red.x <- data_red %>% select(-quality)
data_white.x <- data_white %>% select(-quality)
```

### Data Exploration

```{r}
## Statistical summary:

# Red wines:
print("Red wines:")
summary(data_red)

# White wines:
print("White wines:")
summary(data_white)
```

```{r}
## Bar charts of dependent variable:

r.bar <- ggplot(data_red, aes(x = quality)) + geom_bar(color = "white") + ggtitle("Red Wine Quality Scores")
w.bar <- ggplot(data_white, aes(x = quality)) + geom_bar(color = "white") + ggtitle("White Wine Quality Scores")

grid.arrange(r.bar, w.bar, ncol = 2)
```

```{r}
## Histograms of independent variables:

# Function for generating histograms:

generate_histograms <- function(df) {
  plot_list <- vector('list', length(df))
  name_list <- names(df)
  
  for (i in seq_along(df)) {
    df.x <- df[[name_list[i]]]
    plot_list[[i]] <- ggplot(data = df, aes(x = .data[[name_list[i]]])) + 
      geom_histogram(color = "white", 
                     binwidth = (max(df.x)-min(df.x))/ceiling(sqrt(length(df.x))))
  }
  return(plot_list)
}

# Red wines:

r.hist <- generate_histograms(data_red.x)

grid.arrange(grobs = r.hist[1:6], ncol = 2, 
             top=textGrob("Histograms of Red Wine Variables (1 of 2)"))
grid.arrange(grobs = r.hist[7:11], ncol = 2, 
             top=textGrob("Histograms of Red Wine Variables (2 of 2)"))

# White wines:

w.hist <- generate_histograms(data_white.x)

grid.arrange(grobs = w.hist[1:6], ncol = 2, 
             top=textGrob("Histograms of White Wine Variables (1 of 2)"))
grid.arrange(grobs = w.hist[7:11], ncol = 2, 
             top=textGrob("Histograms of White Wine Variables (2 of 2)"))

```

```{r}
## Jitter plots of independent variables and dependent variable:

# Function for generating jitter plots:

generate_jitter_plots <- function(df, y_name) {
  y = df[, y_name]
  x = df[, -which(names(df) %in% y_name)]
  plot_list <- vector('list', length(x))
  name_list <- names(x)
  
  for (i in seq_along(x)) {
    plot_list[[i]] <- ggplot(data = df, aes(x = .data[[name_list[i]]], y = .data[[y_name]])) + geom_jitter()
  }
  return(plot_list)
}

# Red wines:

r.jplots <- generate_jitter_plots(data_red, "quality")

grid.arrange(grobs = r.jplots[1:4], ncol = 2, 
             top=textGrob("Scatter Plots of Red Wine Variables vs. Quality (1 of 3)"))
grid.arrange(grobs = r.jplots[5:8], ncol = 2, 
             top=textGrob("Scatter Plots of Red Wine Variables vs. Quality (2 of 3)"))
grid.arrange(grobs = r.jplots[9:11], ncol = 2, 
             top=textGrob("Scatter Plots of Red Wine Variables vs. Quality (3 of 3)"))

# White wines:

w.jplots <- generate_jitter_plots(data_white, "quality")

grid.arrange(grobs = w.jplots[1:4], ncol = 2, 
             top=textGrob("Scatter Plots of White Wine Variables vs. Quality (1 of 3)"))
grid.arrange(grobs = w.jplots[5:8], ncol = 2, 
             top=textGrob("Scatter Plots of White Wine Variables vs. Quality (2 of 3)"))
grid.arrange(grobs = w.jplots[9:11], ncol = 2, 
             top=textGrob("Scatter Plots of White Wine Variables vs. Quality (3 of 3)"))
```

```{r}
## Box plots:

# Function for generating histograms:

generate_box_plots <- function(df) {
  plot_list <- vector('list', length(df))
  name_list <- names(df)
  
  for (i in seq_along(df)) {
    plot_list[[i]] <- ggplot(data = df, aes(y = .data[[name_list[i]]])) + 
      geom_boxplot() + 
      coord_cartesian(xlim = c(-1, 1)) + 
      theme(axis.text.x = element_blank(), axis.ticks.x = element_blank())
  }
  return(plot_list)
}

# Red wines:

r.bplots <- generate_box_plots(data_red.x)

grid.arrange(grobs = r.bplots[1:6], ncol = 2, 
             top=textGrob("Box Plots of Red Wine Variables (1 of 2)"))
grid.arrange(grobs = r.bplots[7:11], ncol = 2, 
             top=textGrob("Box Plots of Red Wine Variables (2 of 2)"))

# White wines:

w.bplots <- generate_box_plots(data_white.x)

grid.arrange(grobs = w.bplots[1:6], ncol = 2, 
             top=textGrob("Box Plots of White Wine Variables (1 of 2)"))
grid.arrange(grobs = w.bplots[7:11], ncol = 2, 
             top=textGrob("Box Plots of White Wine Variables (2 of 2)"))
```

```{r}
## Q-Q plots:

# Function for generating Q-Q plots:

generate_qq_plots <- function(df) {
  plot_list <- vector('list', length(df))
  name_list <- names(df)
  
  for (i in seq_along(df)) {
    plot_list[[i]] <- ggqqplot(data = df, x = name_list[i], title = name_list[i])
  }
  return(plot_list)
}

# Red wines:

r.qqplots <- generate_qq_plots(data_red.x)

grid.arrange(grobs = r.qqplots[1:4], ncol = 2, 
             top=textGrob("Q-Q Plots of Red Wine Variables (1 of 3)"))
grid.arrange(grobs = r.qqplots[5:8], ncol = 2, 
             top=textGrob("Q-Q Plots of Red Wine Variables (2 of 3)"))
grid.arrange(grobs = r.qqplots[9:11], ncol = 2, 
             top=textGrob("Q-Q Plots of Red Wine Variables (3 of 3)"))

# White wines:

w.qqplots <- generate_qq_plots(data_white.x)

grid.arrange(grobs = w.qqplots[1:4], ncol = 2, 
             top=textGrob("Q-Q Plots of White Wine Variables (1 of 3)"))
grid.arrange(grobs = w.qqplots[5:8], ncol = 2, 
             top=textGrob("Q-Q Plots of White Wine Variables (2 of 3)"))
grid.arrange(grobs = w.qqplots[9:11], ncol = 2, 
             top=textGrob("Q-Q Plots of White Wine Variables (3 of 3)"))
```

```{r}
## Correlation matrix:

# Red wines:
r.corr.matrix <- cor(data_red.x)
corrplot(r.corr.matrix, method="circle")

# White wines:
w.corr.matrix <- cor(data_white.x)
corrplot(w.corr.matrix, method="circle")
```

```{r}
## Principal component analysis:

# Red wines:

r.data_pca <- PCA(data_red, scale.unit = TRUE, 
                  ncp = 11, quali.sup = 12, 
                  graph = FALSE)

fviz_screeplot(r.data_pca, 
	choice = "eigenvalue", 
	ncp = 11)

print("Red Wine:")
r.data_pca$eig

r.eig_kc <- r.data_pca$eig %>%
	as.data.frame() %>%  
	filter(eigenvalue > 1.0)
r.eig_kc

# White wines:

w.data_pca <- PCA(data_white, scale.unit=TRUE, 
                  ncp=11, quali.sup=12, 
                  graph=FALSE)

fviz_screeplot(w.data_pca, 
	choice = "eigenvalue", 
	ncp = 11)

print("White Wine:")
w.data_pca$eig

w.eig_kc <- w.data_pca$eig %>%
	as.data.frame() %>%  
	filter(eigenvalue > 1.0)
w.eig_kc
```

### Analysis and Model Evaluation:

```{r}

```